{{ define "main" }}
<div class="specialty-page">
    <div class="container">
        {{ $specialtySlug := path.Base .RelPermalink }}
        {{ $specialtySlug = strings.TrimSuffix "/" $specialtySlug }}
        
        {{ range site.Data.specialties.specialties }}
          {{ if eq (path.Base .url) (printf "%s/" $specialtySlug) }}
            {{ if .video }}
              {{ $videoPath := .video }}
              <div class="specialty-video-container">
                <video id="specialty-video" width="100%" muted loop playsinline preload="auto" style="max-width: 800px; margin: 2rem auto; display: block; border-radius: 8px;">
                    <source src="{{ $videoPath }}" type="video/mp4">
                    Tu navegador no soporta el elemento de video.
                </video>
              </div>
            {{ end }}
          {{ end }}
        {{ end }}
        
        {{ .Content }}
    </div>
</div>

<style>
.specialty-page {
    padding: 2rem 0;
}

.specialty-page h1 {
    color: #1e3a8a;
    font-size: 2.5rem;
    margin-bottom: 1.5rem;
    text-align: center;
}

.specialty-page h2 {
    color: #1e3a8a;
    font-size: 2rem;
    margin: 2rem 0 1rem 0;
    text-align: center;
}

.specialty-page h3 {
    color: #2563eb;
    font-size: 1.5rem;
    margin: 1.5rem 0 1rem 0;
}

.specialty-page h4 {
    color: #1e3a8a;
    font-size: 1.25rem;
    margin: 1.25rem 0 0.75rem 0;
}

.specialty-page p {
    line-height: 1.8;
    margin-bottom: 1rem;
    color: #333;
}

.specialty-page img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    margin: 1.5rem 0;
}

.specialty-page iframe {
    width: 100%;
    height: 400px;
    border: none;
    border-radius: 8px;
    margin: 2rem 0;
}

.team-section {
    margin: 2rem 0;
    text-align: center;
}

.team-section img {
    max-width: 600px;
    margin: 1rem auto;
    display: block;
}

.team-section h3 {
    color: #1e3a8a;
    font-size: 1.5rem;
    margin: 1rem 0;
}

.team-section p {
    color: #666;
    line-height: 1.6;
    max-width: 700px;
    margin: 0 auto 2rem;
}

.specialists-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1.5rem;
    margin: 2rem 0;
    padding: 2rem 0;
}

.specialist-card {
    background: white;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
    transition: all 0.3s ease;
}

.specialist-card:hover {
    border-color: #2563eb;
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
    transform: translateY(-2px);
}

.specialist-card img {
    width: 70px;
    height: 70px;
    margin: 0 auto 1rem;
    display: block;
}

.specialist-card p {
    color: #1e3a8a;
    font-weight: 500;
    font-size: 0.95rem;
    margin: 0;
    line-height: 1.4;
}

@media (max-width: 768px) {
    .specialty-page h1 {
        font-size: 2rem;
    }
    
    .specialty-page h2 {
        font-size: 1.5rem;
    }
    
    .specialists-grid {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Find all h2 elements with "Especialistas en..." text
    const h2Elements = document.querySelectorAll('.specialty-page h2');
    
    h2Elements.forEach(h2 => {
        if (h2.textContent.trim().toLowerCase().includes('especialistas en')) {
            // Create grid container
            const grid = document.createElement('div');
            grid.className = 'specialists-grid';
            
            // Find all following siblings until next h2 or h3
            let currentElement = h2.nextElementSibling;
            const elementsToMove = [];
            
            while (currentElement) {
                if (currentElement.tagName === 'H2' || currentElement.tagName === 'H3') {
                    break;
                }
                
                // Check if it's an image or paragraph pair
                if (currentElement.tagName === 'IMG' || 
                    (currentElement.tagName === 'P' && currentElement.previousElementSibling?.tagName === 'IMG')) {
                    elementsToMove.push(currentElement);
                }
                
                currentElement = currentElement.nextElementSibling;
            }
            
            // Group elements into cards
            for (let i = 0; i < elementsToMove.length; i += 2) {
                const img = elementsToMove[i];
                const p = elementsToMove[i + 1];
                
                if (img && img.tagName === 'IMG' && p && p.tagName === 'P') {
                    const card = document.createElement('div');
                    card.className = 'specialist-card';
                    card.appendChild(img.cloneNode(true));
                    card.appendChild(p.cloneNode(true));
                    grid.appendChild(card);
                    
                    // Remove original elements
                    img.remove();
                    p.remove();
                }
            }
            
            // Insert grid after h2
            if (grid.children.length > 0) {
                h2.parentNode.insertBefore(grid, h2.nextSibling);
            }
        }
    });
    
    // Auto-play videos
    const video = document.getElementById('specialty-video');
    if (video) {
        video.muted = true;
        video.play().catch(error => {
            console.log('Video autoplay failed:', error);
            // Try again after a short delay
            setTimeout(() => {
                video.play().catch(e => console.log('Retry failed:', e));
            }, 100);
        });
    }
});
</script>
{{ end }}
